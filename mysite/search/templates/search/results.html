<!DOCTYPE html>
<html> 
<head>
    <!-- Sets the background image -->
    <style type = "text/css">
body {

    background-image: url("https://wallpaperscraft.com/image/surface_network_light_background_texture_50497_1920x1200.jpg");
    background-repeat: repeat-y;
}
</style>
</head>
<title> Results</title>

<h1> Here are your results </h1>
<p id = "b"></p>
<ul>
  <!--
    {% for result in results %}
    <li> 
    <form method="post" action="{% url 'detailed_results'%}">
    	{% csrf_token %}
    	<p> {{ result.address }}<br> Price: ${{result.price}}<br> Score: {{ result.score }}
        <br> Type: {{ result.house_type }}<br> Bathrooms: {{ result.bathroom }}<br> Bedrooms: {{ result.bedroom }}
        </p>
    <input type="hidden" name="house_id" value=" {{ result.house_id }}">
    
    <input type="submit" value="Learn more" display="none">
    </form>
    </li>
    {% endfor %}
-->
    <form method="post" action="{% url 'detailed_results'%}">
      {% csrf_token %}
     
    <input type="hidden" id="house_id" name = "house_id" value=""/>
    
    <input type="submit" value="SELECT" display="none">
</ul>

  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['table', 'bar']});
      google.charts.setOnLoadCallback(drawTable);
      google.charts.setOnLoadCallback(drawChart);

      function drawTable() {

        var data = new google.visualization.DataTable();

        //var results = "{{ variable_list }}";

        //var len_results = results.length;
        data.addColumn('string', 'house_id');
        data.addColumn('string', 'Address');
        data.addColumn('string', 'Score');
        data.addColumn('number', 'Price');
        data.addColumn('string', 'House Type');
        data.addColumn('string', 'Bathrooms');
        data.addColumn('string', 'Bedrooms');

        

        {% for result in results %}

        data.addRow(

          ['{{result.house_id}}','{{result.address}}', '{{result.score}}',  parseInt('{{result.price}}'), '{{result.house_type}}', '{{result.bathroom}}', '{{result.bedroom}}']);

        {% endfor %}

    

        var table = new google.visualization.Table(document.getElementById('table_div'));



        table.draw(data, {showRowNumber: false, width: '50%', height: '50%'});

        google.visualization.events.addListener(table, 'select', selectHandler);












// The selection handler.

// Loop through all items in the selection and concatenate

// a single message from all of them.

function selectHandler() {
  var selection = table.getSelection();
  
  for (var i = 0; i < selection.length; i++) {
    var item = selection[i];
    if (item.row != null) {
      var str = data.getFormattedValue(item.row, 0);
      var message = str;
    }
    }
    document.getElementById("b").innerHTML = message;
    document.getElementById("house_id").value = message;
}

      }
      function drawChart() {
        var data = new google.visualization.DataTable();

        //var results = "{{ variable_list }}";

        //var len_results = results.length;
        data.addColumn('string', 'Address');
        {% for crime_type in database_cat %}

        data.addColumn('number', '{{crime_type}}');

        {% endfor %}


        {% for data in bar_data %}

        data.addRow(

          ['{{data.0}}',parseInt('{{data.1}}'),parseInt('{{data.2}}'),parseInt('{{data.3}}'),parseInt('{{data.4}}')]);

        {% endfor %}

        var options = {
          chart: {
            title: 'Company Performance',
            subtitle: 'Sales, Expenses, and Profit: 2014-2017',
          },
          bars: 'horizontal' // Required for Material Bar Charts.
        };

        var chart = new google.charts.Bar(document.getElementById('barchart'));

        chart.draw(data, options);
      }

    </script>

  </head>

  <body>

    <div id="table_div"></div>
    <div id="barchart" style="width: 900px; height: 500px;"></div>

  </body>












</html>